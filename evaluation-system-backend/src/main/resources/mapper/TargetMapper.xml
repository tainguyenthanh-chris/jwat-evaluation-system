<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.clt.evaluation_system_backend.mapper.TargetMapper">

    <!--    selectFormTmplItem by dept, pos, lvl-->
    <select id="selectTarget"
        resultType="com.clt.evaluation_system_backend.dto.response.TargetResponse"> SELECT f.form_id
        AS formId, f.dept_cd AS departmentCode, f.pos_cd AS positionCode, f.lvl_cd AS levelCode,
        st.sec_id AS sectionId, st.sec_title as sectionTitle, ft.sec_ord_no as sectionOrderNo,
        cri.criteria_id AS criteriaId, cri.criteria_cnt as criteriaContent, ft.criteria_ord_no as
        criteriaOrderNo, rc.rev_conf_type AS type, rc.rev_conf_roles AS roles FROM form_tmpl ft LEFT
        JOIN criteria cri ON cri.criteria_id = ft.criteria_id LEFT JOIN sec st ON st.sec_id =
        ft.sec_id LEFT JOIN form f ON f.form_id = ft.form_id LEFT JOIN rev_conf rc ON rc.rev_conf_cd
        = ft.rev_conf_cd WHERE f.dept_cd = #{department} AND f.pos_cd = #{position} AND f.lvl_cd =
        #{level} AND f.form_status != 'OLD' AND f.del_flg != 'T' AND st.sec_status != 'OLD' AND
        st.del_flg != 'T' AND cri.criteria_status != 'OLD' AND cri.del_flg != 'T' ORDER BY
        ft.sec_ord_no, ft.criteria_ord_no ASC; </select>

    <update id="updateTargets">
        <foreach collection="list"
            item="t"
            separator=";"> UPDATE target SET target_status = #{t.targetStatus}, upd_usr_id =
        #{t.updUsrId}, upd_dt = #{t.updDt} WHERE target_id = #{t.targetId} AND del_flg = 'F' </foreach>
    </update>

    <insert id="insertTargets"> INSERT INTO target ( form_subm_id, form_detail_id, target_ord_no,
        target_cnt, target_status, rev_usr_id, rev_dt, cre_usr_id, upd_usr_id ) VALUES <foreach
            collection="list" item="t" separator=","> ( #{t.formSubmId}, #{t.formDetailId},
        #{t.targetOrdNo}, #{t.targetCnt}, #{t.targetStatus}, #{t.revUsrId}, #{t.revDt},
        #{t.creUsrId}, #{t.updUsrId} ) </foreach>
    </insert>

</mapper>