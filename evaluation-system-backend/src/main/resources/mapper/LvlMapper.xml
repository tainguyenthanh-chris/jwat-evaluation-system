<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.clt.evaluation_system_backend.mapper.LvlMapper">


    <sql id="lvl_columns"> lvl_id as levelId, lvl_nm as levelName, lvl_cd as levelCode, lvl_desc as
        levelDescription, cre_usr_id as createBy, cre_dt as createDate, upd_usr_id as updateBy,
        upd_dt as updateDate, del_flg as deleteFlag </sql>

    <insert id="insert"
        parameterType="com.clt.evaluation_system_backend.model.Lvl"> INSERT INTO lvl ( lvl_id,
        lvl_nm, lvl_cd, lvl_desc, cre_usr_id, cre_dt, upd_usr_id, upd_dt, del_flg, pos_id ) VALUES (
        #{lvlId}, #{lvlNm}, #{lvlCd}, #{lvlDesc}, #{creUsrId}, CURRENT_TIMESTAMP, #{creUsrId},
        CURRENT_TIMESTAMP, 'F', #{posId} ) </insert>


    <update id="update"
        parameterType="com.clt.evaluation_system_backend.model.Lvl"> UPDATE lvl SET lvl_nm =
        #{lvlNm}, lvl_cd = #{lvlCd}, lvl_desc = #{lvlDesc}, upd_usr_id = #{updUsrId}, upd_dt =
        CURRENT_TIMESTAMP WHERE lvl_id = #{lvlId} </update>


    <update id="deleteById" parameterType="String"> UPDATE lvl SET del_flg = 'T', upd_usr_id =
        'dev', upd_dt = CURRENT_TIMESTAMP WHERE lvl_id = #{lvlId} </update>


    <select id="findById"
        parameterType="String"
        resultType="com.clt.evaluation_system_backend.dto.response.LvlResponse"> SELECT <include
            refid="lvl_columns" /> FROM lvl WHERE lvl_id = #{lvlId} AND del_flg = 'F' </select>


    <select id="findAll"
        parameterType="com.clt.evaluation_system_backend.dto.request.LvlSearchRequest"
        resultType="com.clt.evaluation_system_backend.dto.response.LvlResponse"> SELECT <include
            refid="lvl_columns" /> FROM lvl WHERE del_flg = 'F' <if
            test="lvlNm != null and lvlNm != ''"> AND lvl_nm ILIKE CONCAT('%', #{lvlNm}, '%') </if>

    <if
            test="lvlCd != null and lvlCd != ''"> AND lvl_cd = #{lvlCd} </if> ORDER BY cre_dt DESC </select>


</mapper>